- [What is POM?](#what-is-pom)
- [What is `gradle.lockfile`?](#what-is-gradlelockfile)
- [A challenge](#a-challenge)
- [How to test](#how-to-test)

## 2. Parsing Gradle's `gradle.lockfile`

### What is POM?

> A Project Object Model or POM is the fundamental unit of work in Maven. It is an XML file that contains information about the project and configuration details used by Maven to build the project. It contains default values for most projects.
> --- https://maven.apache.org/guides/introduction/introduction-to-the-pom

```xml
<dependencies>
  <dependency>
    <groupId>org.apache.logging.log4j</groupId>
    <artifactId>log4j-core</artifactId>
    <version>2.14.1</version>
  </dependency>
  <dependency>
    <groupId>org.apache.logging.log4j</groupId>
    <artifactId>log4j-api</artifactId>
    <version>2.14.1</version>
  </dependency>
</dependencies>
```

### What is `gradle.lockfile`?

> To achieve reproducible builds, it is necessary to lock versions of dependencies and transitive dependencies such that a build with the same inputs will always resolve the same module versions. This is called dependency locking.
>
> - Each line still represents a single dependency in the `group:artifact:version` notation
> - It then lists all configurations that contain the given dependency
> - Module and configurations are ordered alphabetically, to ease diffs
> - The last line of the file lists all empty configurations, that is configurations known to have no dependencies
> --- https://docs.gradle.org/current/userguide/dependency_locking.html

```
org.apache.logging.log4j:log4j-api:2.14.1=compileClasspath,runtimeClasspath
org.apache.logging.log4j:log4j-core:2.14.1=compileClasspath,runtimeClasspath
```

```
{group_id}:{artifact_id}:{version}={classpaths}
```

### A challenge

Implement a function to parse `gradle.lock` and produce a list of CylcloneDX components.

- Implement `parse_gradle_lock()` in `jsac2023/java/gradle.py`
- A CycloneDX component should have `name`, `version` and `purl`
- Use `maven` as a package URL type. (e.g. `pkg:maven/org.apache.logging.log4j/log4j-core@2.14.1"`)
  - See [Package URL Type definitions](https://github.com/package-url/purl-spec/blob/master/PURL-TYPES.rst) for more details

### How to test

The following test tries to test the function with `tests/fixtures/gradle.lockfile` (= `/app/log4j-vulnerable-app/gradle.lockfile` in the dev container)

```bash
pytest tests/java/test_gradle.py
```

Also you can produce CycloneDX SBOM with the function.

```bash
jsac2023-cli java gradle /app/log4j-vulnerable-app/gradle.lockfile | jq .
```
